<mvc:View
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:layout="sap.ui.layout"
    xmlns:unified="sap.ui.unified"
    xmlns:form="sap.ui.layout.form"
    xmlns:table="sap.ui.table"
    controllerName="manager.controller.Manager"
    height="100%"
    displayBlock="true">
    
    <Page id="page1" showHeader="false">
        <content>
            <!-- Top Bar -->
            <Toolbar id="mainToolbar" class="topToolbar">
                <Title id="appTitle" text="Manager Dashboard" level="H3" class="title" />
                <ToolbarSpacer id="_IDGenToolbarSpacer" />
                <Button id="profileButton" icon="sap-icon://person-placeholder" tooltip="My Profile" press="onProfilePress" class="sapUiTinyMarginEnd"/>
                <Button id="notificationButton" icon="sap-icon://bell" press="onNotificationPress" class="sapUiSmallMarginEnd" />
            </Toolbar>
            
            <!-- Main Content with Icon Tab Bar -->
            <IconTabBar id="iconTabBar" select="onTabSelect" expanded="{device>/isNoPhone}" class="sapUiResponsiveContentPadding">
                <items>
                    <!-- Timesheet Tab -->
                    <IconTabFilter id="timesheetTab" key="timesheet" text="Timesheet" icon="sap-icon://time-entry-request">
            <!-- Existing timesheet content remains the same -->
            <Panel id="timesheetPanel" headerText="Daily Time Entry" expandable="true" expanded="true">
                <headerToolbar>
                    <Toolbar>
                        <ToolbarSpacer/>
                        <Button text="Previous Week" icon="sap-icon://navigation-left-arrow" press="onPreviousWeek"/>
                        <Button text="Current Week" type="Emphasized" press="onCurrentWeek"/>
                        <Button text="Next Week" press="onNextWeek"/>
                        <DatePicker 
                            id="datePicker" 
                            value="{
                                path: '/selectedDate',
                                type: 'sap.ui.model.type.Date',
                                formatOptions: {
                                    pattern: 'yyyy-MM-dd'
                                }
                            }" 
                            change="onDatePickerChange" 
                            width="150px"
                        />
                    </Toolbar>
                </headerToolbar>

                <content>
                    <HBox width="100%" class="sapUiTinyMargin">

                        <!-- Employee List -->
                        <VBox width="16%">
                            <Label text="Employees" class="sapUiSmallMarginBottom sapUiTinyMarginStart"/>
                            <ScrollContainer height="400px" vertical="true">
                                <SearchField id="employeeSearchField"
                                    placeholder="Search Employee..."
                                    liveChange="onSearchEmployee"/>
                                <List id="employeeList"
                                    items="{
                                        path: '/users'
                                    }"
                                    mode="SingleSelectMaster"
                                    selectionChange="onEmployeeListSelect"
                                    includeItemInSelection="true">
                                    <StandardListItem
                                        title="{firstName} {lastName}"
                                        type="Active"
                                        icon="{= ${roleName} === 'Manager' ? 'sap-icon://manager' : 'sap-icon://employee'}"
                                        class="{= ${hasNoTimesheetData} ? 'highlightRed' : ''}"
                                    />
                                </List>
                            </ScrollContainer>
                        </VBox>

                        <!-- Timesheet Table -->
                        <VBox width="84%">
                            <Label 
                                text="{= ${/selectedEmployeeName} ? ${/selectedEmployeeName} : 'Select an Employee'}"
                                class="sapUiSmallMarginStart sapUiSmallMarginBottom"/>
                                
                            <Table id="timesheetTable"
                                items="{/timesheetEntries}"
                                class="sapUiResponsiveMargin"
                                fixedLayout="true"
                                growing="true"
                                growingThreshold="10">

                                <columns>
                                    <Column width="8%" hAlign="Center">
                                        <Text text="Project"/>
                                    </Column>
                                    <Column width="10%" hAlign="Center">
                                        <Text text="Task"/>
                                    </Column>
                                    <Column width="8%" hAlign="Center">
                                        <Text text="Task Details"/>
                                    </Column>
                                    <Column width="8%" hAlign="Center">
                                        <Text text="Total Hours"/>
                                    </Column>
                                    <!-- Day Columns -->
                                    <Column width="6%" hAlign="Center">
                                        <Text text="{/weekDays/0}"/>
                                    </Column>
                                    <Column width="6%" hAlign="Center">
                                        <Text text="{/weekDays/1}"/>
                                    </Column>
                                    <Column width="6%" hAlign="Center">
                                        <Text text="{/weekDays/2}"/>
                                    </Column>
                                    <Column width="6%" hAlign="Center">
                                        <Text text="{/weekDays/3}"/>
                                    </Column>
                                    <Column width="6%" hAlign="Center">
                                        <Text text="{/weekDays/4}"/>
                                    </Column>
                                    <Column width="6%" hAlign="Center">
                                        <Text text="{/weekDays/5}"/>
                                    </Column>
                                    <Column width="6%" hAlign="Center">
                                        <Text text="{/weekDays/6}"/>
                                    </Column>
                                    <Column width="13%" hAlign="Center">
                                        <Text text="Actions"/>
                                    </Column>
                                </columns>

                                <items>
                                    <ColumnListItem>
                                        <cells>
                                            <Text text="{project}"/>
                                            <Text text="{task}"/>
                                            <HBox alignItems="Center" justifyContent="Center">
                                               
                                                <Button icon="sap-icon://list" type="Transparent" press="onTaskDetailPress"/>
                                            </HBox>
                                            <Text text="{totalHours}"/>
                                            <!-- Day Columns -->
                                            <Button text="{monday}" press="onHourButtonPress" />
                                            <Button text="{tuesday}" press="onHourButtonPress" />
                                            <Button text="{wednesday}" press="onHourButtonPress" />
                                            <Button text="{thursday}" press="onHourButtonPress" />
                                            <Button text="{friday}" press="onHourButtonPress"/>
                                            <Button text="{saturday}" press="onHourButtonPress" />
                                            <Button text="{sunday}" press="onHourButtonPress" />
                                            <!-- Actions -->
                                            <HBox justifyContent="Center">
                                                <!-- APPROVE BUTTON (GREEN + ICON) -->
                                                <Button
                                                    text=""
                                                    type="Accept"
                                                    icon="sap-icon://accept"
                                                    press="onApproveTimesheet"
                                                    enabled="{= ${status} !== 'Approved'}"
                                                    class="sapUiTinyMarginEnd"
                                                />

                                                <!-- REJECT BUTTON (RED + ICON) -->
                                                <Button
                                                    text=""
                                                    type="Reject"
                                                    icon="sap-icon://decline"
                                                    press="onRejectTimesheet"
                                                    enabled="{= ${status} !== 'Rejected'}"
                                                />
                                            </HBox>
                                        </cells>
                                    </ColumnListItem>
                                </items>
                            </Table>
                        </VBox>
                    </HBox>
                </content>
            </Panel>
        </IconTabFilter>

                    
                    <!-- Project Reports Tab -->
                    <!-- In the Project Reports Tab section -->
<IconTabFilter id="projectReportsTab" text="Project Reports" icon="sap-icon://pie-chart">
    <ScrollContainer height="100%" vertical="true" class="sapUiResponsiveMargin">
        <!-- Assign Project Button -->
        <Toolbar class="sapUiTinyMarginBottom">
            <ToolbarSpacer/>
            <Button 
                text="Assign Project" 
                icon="sap-icon://add" 
                press="onAssignProject"
                type="Emphasized"
            />
        </Toolbar>
        
        <!-- Dynamic Project Panels -->
        <VBox items="{/projectsData}">
            <items>
                <Panel expandable="true" expanded="false" headerText="{projectName}">
                    <headerToolbar>
                        <Toolbar>
                            <Title text="{projectName}" level="H4"/>
                            <ToolbarSpacer/>
                            <ObjectStatus 
                                text="{status}" 
                                state="{path: 'status', formatter: '.formatProjectStatusState'}"
                                class="sapUiSmallMarginEnd"/>
                            <Text text="Assigned Employees: {= ${assignedEmployees}.length || 0 }"/>
                        </Toolbar>
                    </headerToolbar>
                    
                    <content>
                        <!-- Assigned Employees Table -->
                        <table:Table
                            id="assignedEmployeesTable"
                            rows="{path: 'assignedEmployees', templateShareable: false}"
                            visibleRowCount="5"
                            width="100%"
                            class="sapUiSmallMarginTop">
                            <table:columns>
                                <table:Column width="30%">
                                    <Label text="Employee Name"/>
                                    <table:template>
                                        <Text text="{employeeName}"/>
                                    </table:template>
                                </table:Column>
                                
                                <!-- <table:Column width="30%">
                                    <Label text="Project"/>
                                    <table:template>
                                        <Text text="{path: '>projectName'}"/>
                                    </table:template>
                                </table:Column>
                                
                                <table:Column width="20%">
                                    <Label text="Assigned Date"/>
                                    <table:template>
                                        <Text text="{path: 'assignmentDate', formatter: '.formatShortDate'}"/>
                                    </table:template>
                                </table:Column> -->
                                
                                <table:Column width="20%">
                                    <Label text="Actions"/>
                                    <table:template>
                                        <Button 
                                            text="" 
                                            type="Reject"
                                            icon="sap-icon://delete"
                                            press="onRemoveFromProject"
                                            class="sapUiTinyMarginEnd"
                                        />
                                    </table:template>
                                </table:Column>
                            </table:columns>
                        </table:Table>
                    </content>
                </Panel>
            </items>
        </VBox>
    </ScrollContainer>
</IconTabFilter>

<IconTabFilter 
    id="reportTab"
    text="Reports"
    key="reportsTab"
    icon="sap-icon://business-objects-experience">

    <VBox class="sapUiSmallMargin">

        <!-- REPORT PANEL -->
        <Panel 
            id="reportPanel"
            expandable="true"
            expanded="true"
            headerText="Team Progress Report">

            <!-- TABLE INSIDE PANEL -->
            <content>
                <Table
                    id="reportTable"
                    inset="false"
                    width="100%"
                    growing="true"
                    growingScrollToLoad="true"
                    items="{/teamProgressReport}"
                    class="sapUiSizeCompact">

                    <!-- ========== TABLE COLUMNS ========== -->
                    <columns>
                        <Column width="12rem">
                            <Text text="Employee Name" />
                        </Column>

                        <Column width="12rem">
                            <Text text="Project Name" />
                        </Column>

                        <Column width="10rem" hAlign="Center">
                            <Text text="Allocated Hours" />
                        </Column>

                        <Column width="10rem" hAlign="Center">
                            <Text text="Booked Hours" />
                        </Column>

                        <Column width="10rem" hAlign="Center">
                            <Text text="Remaining Hours" />
                        </Column>

                        <Column width="10rem" hAlign="Center">
                            <Text text="Utilization" />
                        </Column>
                    </columns>

                    <!-- ========== ROW TEMPLATE ========== -->
                    <items>
                        <ColumnListItem>
                            <cells>

                                <!-- EMPLOYEE NAME -->
                                <Text text="{employeeName}" />

                                <!-- PROJECT NAME -->
                                <Text text="{projectName}" />

                                <!-- ALLOCATED HOURS -->
                                <Text text="{allocatedHours}" />

                                <!-- BOOKED HOURS -->
                               <Text text="{totalBookedHours}" />

                               <Text text="{remainingHours}" />

                               <ProgressIndicator id="_IDGenProgressIndicator" 
                                displayValue="{utilization}%"
                                percentValue="{utilization}"
                                state="{= ${utilization} > 90 ? 'Error' : ${utilization} > 75 ? 'Warning' : 'Success' }"/>

                            </cells>
                        </ColumnListItem>
                    </items>

                </Table>
            </content>
        </Panel>
    </VBox>

    <VBox class="sapUiSmallMargin">

        <!-- REPORT PANEL -->
        <Panel 
            id="reportPanel2"
            expandable="true"
            expanded="true"
            headerText="Project Summary">

            <!-- TABLE INSIDE PANEL -->
            <content>
                <Table
                    id="reportTable2"
                    inset="false"
                    width="100%"
                    growing="true"
                    growingScrollToLoad="true"
                    items="{/projectSummary}"
                    class="sapUiSizeCompact">

                    <!-- ========== TABLE COLUMNS ========== -->
                    <columns>
                        <Column width="10rem">
                            <Text text="Project Name" />
                        </Column>

                        <Column width="10rem" hAlign="Center">
                            <Text text="Allocated Hours" />
                        </Column>

                        <Column width="10rem" hAlign="Center">
                            <Text text="Start Date" />
                        </Column>

                        <Column width="10rem" hAlign="Center">
                            <Text text="End Date" />
                        </Column>

                        <Column width="10rem" hAlign="Center">
                            <Text text="Duration" />
                        </Column>

                        <Column width="10rem" hAlign="Center">
                            <Text text="Remaining Days" />
                        </Column>

                        <Column width="10rem" hAlign="Center">
                            <Text text="Status" />
                        </Column>

                        <!-- <Column width="10rem" hAlign="Center">
                            <Text text="Status" />
                        </Column> -->
                    </columns>

                    <!-- ========== ROW TEMPLATE ========== -->
                    <items>
                        <ColumnListItem>
                            <cells>

                                <!-- EMPLOYEE NAME -->
                                <Text text="{projectName}" />

                                <!-- PROJECT NAME -->
                                <Text text="{allocatedHours}" />

                                <!-- ALLOCATED HOURS -->
                                <Text text="{startDate}" />
<Text text="{endDate}" />
                                <Text text="{duration}" />


                                <Text text="{remainingDays}" />


                                <Text text="{status}" />

                               

                            </cells>
                        </ColumnListItem>
                    </items>

                </Table>
            </content>
        </Panel>
    </VBox>

</IconTabFilter>



                </items>
            </IconTabBar>
        </content>
    </Page>
</mvc:View>