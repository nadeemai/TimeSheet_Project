//@ui5-bundle admin/Component-preload.js
sap.ui.predefine("admin/Component", ["sap/ui/core/UIComponent","admin/model/models"],(e,t)=>{"use strict";return e.extend("admin.Component",{metadata:{manifest:"json",interfaces:["sap.ui.core.IAsyncContentCreation"]},init(){e.prototype.init.apply(this,arguments);this.setModel(t.createDeviceModel(),"device");this.getRouter().initialize()}})});
sap.ui.predefine("admin/controller/Admin.controller", ["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/ui/model/json/JSONModel","sap/ui/core/Fragment","sap/m/MessageBox","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/Select","sap/ui/core/Item","sap/m/Input","sap/m/DatePicker","sap/m/Button","sap/m/Dialog","sap/m/Text","sap/m/Label","sap/ui/layout/form/SimpleForm","sap/m/ToolbarSpacer","sap/m/Toolbar","sap/ui/model/odata/v2/ODataModel","sap/m/VBox","sap/m/ComboBox","sap/ui/core/BusyIndicator"],function(e,t,a,r,o,s,n,i,l,d,u,c,m,g,p,y,f,h,D,v,w,I){"use strict";return e.extend("admin.controller.Admin",{onInit:function(){var e=new a({users:[],projects:[],projectHours:[],managerTeams:[],projectDurations:[],selectedEmployee:"",selectedDate:new Date,currentWeekStart:this._getWeekStart(new Date),weekDays:[],timesheetEntries:[],employeeProjects:[],weekDates:{},overallProgress:{totalBookedHours:0,totalAllocatedHours:0,totalRemainingHours:0,averageUtilization:0}});this.getView().setModel(e);this._loadEmployees();this._loadProjects();this._loadOverallProgress();this._initializeTimesheet();var t=localStorage.getItem("selectedEmployeeId");if(t){e.setProperty("/selectedEmployee",t);var r=e.getProperty("/currentWeekStart");var o=this._getWeekEnd(r);this._loadAdminTimesheetData(t,r,o)}},onLogoutPress:function(){var e=this;o.confirm("Are you sure you want to logout?",{title:"Confirm Logout",icon:o.Icon.QUESTION,actions:[o.Action.OK,o.Action.CANCEL],emphasizedAction:o.Action.OK,onClose:function(t){if(t===o.Action.OK){e._performLogout()}}})},_performLogout:function(){I.show(0);try{localStorage.removeItem("selectedEmployeeId");localStorage.clear();sessionStorage.clear();var e=this.getView().getModel();if(e){e.setData({users:[],projects:[],projectHours:[],managerTeams:[],projectDurations:[],selectedEmployee:"",selectedDate:new Date,currentWeekStart:this._getWeekStart(new Date),weekDays:[],timesheetEntries:[],employeeProjects:[],weekDates:{},overallProgress:{totalBookedHours:0,totalAllocatedHours:0,totalRemainingHours:0,averageUtilization:0}})}t.show("Logged out successfully");var a=this;setTimeout(function(){var e=a.getOwnerComponent().getRouter();if(e){e.navTo("RouteLogin",{},true)}else{window.location.href="/index.html"}I.hide()},1e3)}catch(e){console.error("Error during logout:",e);I.hide();t.show("Error during logout. Please try again.")}},onAnalyticsPress:function(){var e=this;if(!this._oAnalyticsDialog){var t=new sap.m.VBox({items:[new sap.m.Title({text:"Progress Reports:"}).addStyleClass("sapUiSmallMarginTop sapUiSmallMarginBottom sapUiSmallMarginBegin"),new sap.m.VBox(this.createId("projectListContainer")).addStyleClass("sapUiSmallMarginBegin sapUiSmallMarginEnd sapUiTinyMarginBottom")]});var a=new sap.m.ScrollContainer({width:"100%",height:"100%",vertical:true,content:[t]});this._oAnalyticsDialog=new sap.m.Dialog({title:"Project Progress Summary",icon:"sap-icon://message-information",type:"Message",contentWidth:"420px",contentHeight:"70vh",stretch:sap.ui.Device.system.phone,verticalScrolling:false,content:[a],beginButton:new sap.m.Button({text:"OK",type:"Emphasized",press:function(){e._oAnalyticsDialog.close()}})});this.getView().addDependent(this._oAnalyticsDialog)}this._oAnalyticsDialog.open();var r=this.byId("projectListContainer");r.removeAllItems();r.addItem(new sap.m.BusyIndicator({size:"2rem"}).addStyleClass("sapUiMediumMargin"));var o=this.getOwnerComponent().getModel("adminService");o.read("/Projects",{success:function(e){var t=e.results||[];r.removeAllItems();if(t.length===0){r.addItem(new sap.m.Text({text:"No projects found."}));return}t.forEach(function(e,a){var o=e.projectName||"Unnamed Project";var s=e.startDate?new Date(e.startDate).toLocaleDateString("en-GB"):"";var n=e.endDate?new Date(e.endDate).toLocaleDateString("en-GB"):"";var i=e.status||"Draft";var l=e.usedHours||0;var d=new sap.m.VBox({items:[new sap.m.Title({text:"Project: "+o,level:"H6"}).addStyleClass("sapUiTinyMarginBottom"),new sap.m.FormattedText({htmlText:"<strong>Total Hours Worked:</strong> "+l+"<br>"+"<strong>Start Date:</strong> "+s+"<br>"+"<strong>End Date:</strong> "+n+"<br>"+"<strong>Status:</strong> "+i})]}).addStyleClass("sapUiSmallMarginBottom sapUiTinyMarginBeginEnd");r.addItem(d);if(a<t.length-1){r.addItem(new sap.m.HBox({height:"1px"}).addStyleClass("separatorLine"))}})},error:function(){r.removeAllItems();r.addItem(new sap.m.MessageStrip({text:"Failed to load project data.",type:"Error",showIcon:true}))}})},onNotificationPress:function(){if(!this._oNotificationDialog){this._oNotificationDialog=new sap.m.Dialog({title:"Notifications",contentWidth:"80%",contentHeight:"75vh",stretch:sap.ui.Device.system.phone,content:new sap.m.List({id:this.createId("notificationList"),noDataText:"No notifications found",mode:sap.m.ListMode.None,items:{path:"/notifications",template:new sap.m.StandardListItem({title:"{title}",description:"{message}",info:"{createdAt}",infoState:"{= ${read} ? 'Success' : 'Warning' }",icon:"{= ${read} ? 'sap-icon://message-success' : 'sap-icon://message-information' }"})}}),beginButton:new sap.m.Button({text:"Close",press:function(){this._oNotificationDialog.close()}.bind(this)}),afterClose:function(){}});this.getView().addDependent(this._oNotificationDialog)}this._oNotificationDialog.open();this.byId("notificationList").setBusy(true);var e=this.getOwnerComponent().getModel("adminService");e.read("/Notifications",{success:function(e){var t=e.results||e.value||[];t.sort(function(e,t){return new Date(t.createdAt)-new Date(e.createdAt)});t.forEach(function(e){if(e.createdAt){var t=new Date(e.createdAt);e.createdAt=t.toLocaleDateString()+" "+t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}e.title=e.title||"Notification";e.message=e.message||"";e.read=e.read===true});var a=new sap.ui.model.json.JSONModel({notifications:t});this.byId("notificationList").setModel(a);this.byId("notificationList").setBusy(false)}.bind(this),error:function(e){this.byId("notificationList").setBusy(false);sap.m.MessageToast.show("Error loading Notifications: "+(e.message||"Unknown error"))}.bind(this)})},_loadOverallProgress:function(){var e=this.getOwnerComponent().getModel("adminService");var a=this.getView().getModel();I.show(0);e.read("/OverallProgressReport",{success:function(e){I.hide();var t=e.results||[];var r={};t.forEach(function(e){var t=e.projectID||"unknown";var a=e.projectName||"Unknown Project";var o=parseFloat(e.allocatedHours)||0;var s=parseFloat(e.totalBookedHours)||0;var n=s>=2?Math.round(s):0;var i=o-n;if(!r[t]||o>(r[t].allocatedHours||0)){r[t]={project:a,allocatedHours:o,bookedHours:n,remainingHours:i>0?i:0,projectID:t,activityName:e.activityName,budget:e.budget,employeeID:e.employeeID,employeeName:e.employeeName,managerID:e.managerID,managerName:e.managerName,status:e.status,task:e.task}}});var o=Object.keys(r).map(function(e){return r[e]});o.sort(function(e,t){return e.project.localeCompare(t.project)});a.setProperty("/projectHours",o);var s=o.reduce((e,t)=>e+t.allocatedHours,0);var n=o.reduce((e,t)=>e+t.bookedHours,0);var i=s-n;var l=s>0?Math.round(n/s*100):0;a.setProperty("/overallProgress",{totalAllocatedHours:s,totalBookedHours:n,totalRemainingHours:i,averageUtilization:l});a.refresh(true)},error:function(e){I.hide();console.error("Error loading OverallProgressReport:",e);t.show("Failed to load project analytics data");a.setProperty("/projectHours",[]);a.setProperty("/overallProgress",{totalAllocatedHours:0,totalBookedHours:0,totalRemainingHours:0,averageUtilization:0})}})},onTaskDetailPress:function(e){try{var t=e.getSource();var a=t.getBindingContext();if(!a){sap.m.MessageToast.show("Unable to get binding context");return}var r=a.getObject();var o=this.getView().getModel();var s=this._getWeekDates();if(!s){sap.m.MessageToast.show("Week dates not available");return}r.dailyComments=r.dailyComments||{};var n=this;var i=[{name:"Monday",hours:r.monday||0,comment:r.mondayTaskDetails||"No task details",date:n._formatDateForDisplay(s.monday)},{name:"Tuesday",hours:r.tuesday||0,comment:r.tuesdayTaskDetails||"No task details",date:n._formatDateForDisplay(s.tuesday)},{name:"Wednesday",hours:r.wednesday||0,comment:r.wednesdayTaskDetails||"No task details",date:n._formatDateForDisplay(s.wednesday)},{name:"Thursday",hours:r.thursday||0,comment:r.thursdayTaskDetails||"No task details",date:n._formatDateForDisplay(s.thursday)},{name:"Friday",hours:r.friday||0,comment:r.fridayTaskDetails||"No task details",date:n._formatDateForDisplay(s.friday)},{name:"Saturday",hours:r.saturday||0,comment:r.saturdayTaskDetails||"No task details",date:n._formatDateForDisplay(s.saturday)},{name:"Sunday",hours:r.sunday||0,comment:r.sundayTaskDetails||"No task details",date:n._formatDateForDisplay(s.sunday)}];var l=function(e){if(e===0){return"tsHoursRed"}else if(e>0&&e<8){return"tsHoursOrange"}else if(e>=8&&e<=15){return"tsHoursGreen"}return""};var d=i.map(function(e,t){return new sap.m.VBox({width:"100%",items:[new sap.m.HBox({justifyContent:"SpaceBetween",items:[new sap.m.Text({text:`${e.name} (${e.date})`,design:"Bold"}),new sap.m.Text({text:`${e.hours.toFixed(2)} hrs`,design:"Bold"}).addStyleClass(l(e.hours))]}).addStyleClass("tsDayHeader"),new sap.m.Text({text:e.comment,wrapping:true}).addStyleClass("tsDayComment"),...t<i.length-1?[new sap.m.HBox({height:"1px",class:"tsSeparator"})]:[]]}).addStyleClass("tsDayCard")});var u=new sap.m.Dialog({title:"Week Task Details",contentWidth:"320px",contentHeight:"70vh",stretchOnPhone:true,content:new sap.m.VBox({items:d,class:"sapUiResponsiveMargin"}),endButton:new sap.m.Button({text:"Close",press:function(){u.close()}}),afterClose:function(){u.destroy()}});var c=`\n      .tsDayCard {\n        margin-bottom: 12px;\n        padding: 12px;\n        border-radius: 6px;\n        background-color: #f8f9fa;\n        box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n      }\n      \n      .tsDayHeader {\n        margin-bottom: 8px;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n      }\n      \n      .tsDayComment {\n        margin-top: 8px;\n        color: #555;\n        font-size: 14px;\n        line-height: 1.4;\n      }\n      \n      .tsSeparator {\n        margin: 12px 0;\n        background-color: #e0e0e0;\n        width: 100%;\n      }\n      \n      .tsHoursRed {\n        color: #e74c3c;\n        font-weight: bold;\n      }\n      \n      .tsHoursOrange {\n        color: #f39c12;\n        font-weight: bold;\n      }\n      \n      .tsHoursGreen {\n        color: #27ae60;\n        font-weight: bold;\n      }\n    `;if(!document.getElementById("taskDetailStyles")){var m=document.createElement("style");m.id="taskDetailStyles";m.innerHTML=c;document.head.appendChild(m)}this.getView().addDependent(u);u.open()}catch(e){console.error("Error in onTaskDetailPress:",e)}},_formatDateForDisplay:function(e){if(!e)return"";var t=new Date(e);var a={month:"short",day:"numeric",year:"numeric"};return t.toLocaleDateString("en-US",a)},_getWeekDates:function(){var e=this.getView().getModel();var t=new Date(e.getProperty("/currentWeekStart"));var a={monday:new Date(t),tuesday:new Date(t),wednesday:new Date(t),thursday:new Date(t),friday:new Date(t),saturday:new Date(t),sunday:new Date(t)};a.tuesday.setDate(a.tuesday.getDate()+1);a.wednesday.setDate(a.wednesday.getDate()+2);a.thursday.setDate(a.thursday.getDate()+3);a.friday.setDate(a.friday.getDate()+4);a.saturday.setDate(a.saturday.getDate()+5);a.sunday.setDate(a.sunday.getDate()+6);return a},_initializeTimesheet:function(){let e=this.getView().getModel();let t=new Date(e.getProperty("/currentWeekStart"));let a=[];for(let e=0;e<7;e++){let r=new Date(t);r.setDate(r.getDate()+e);a.push(this._formatDay(r))}e.setProperty("/weekDays",a);let r=this._getWeekEnd(t);let o=e.getProperty("/selectedEmployee");if(o){console.log("Loading timesheet for employee:",o);this._loadAdminTimesheetData(o,t,r)}},_formatDay:function(e){var t={month:"short",day:"numeric"};return e.toLocaleDateString("en-US",t)},_getWeekStart:function(e){var t=new Date(e);var a=t.getDay();var r=t.getDate()-a+(a===0?-6:1);return new Date(t.setDate(r))},_loadAdminTimesheetData:function(e,a,r){let o=this.getOwnerComponent().getModel("adminService");let i=this;let l=this.getView().getModel();I.show(0);let d=e=>{if(!e)return"";return new Date(e).toISOString().split("T")[0]};let u=d(a);let c=d(r);console.log("Loading timesheet data:",{employeeId:e,weekStart:u,weekEnd:c});let m=[new s("employeeEmpID",n.EQ,e),new s("weekStartDate",n.LE,c),new s("weekEndDate",n.GE,u)];o.read("/Timesheets",{filters:m,success:function(t){let a=t.results||[];let r=a.filter(t=>{if(t.employeeEmpID!==e){return false}let a=d(t.weekStartDate);let r=d(t.weekEndDate);return a<=c&&r>=u});console.log("Filtered entries:",r);let o=i._formatAdminTimesheet(r);l.setProperty("/timesheetEntries",o);let s=o.reduce((e,t)=>e+t.totalHours,0);l.setProperty("/totalWeekHours",s);console.log("Filtered Week Data",o);I.hide()},error:function(e){console.error("Error loading timesheet data:",e);t.show("Error loading timesheet data");I.hide()}})},_formatAdminTimesheet:function(e){return e.map(e=>{let t=e.projectName&&e.projectName.trim()!==""?e.projectName:e.nonProjectTypeName||"Non-Project";const a=e=>e?parseFloat(e):0;return{project:t,task:e.task||"",taskDetails:e.taskDetails||"",mondayTaskDetails:e.mondayTaskDetails||"",tuesdayTaskDetails:e.tuesdayTaskDetails||"",wednesdayTaskDetails:e.wednesdayTaskDetails||"",thursdayTaskDetails:e.thursdayTaskDetails||"",fridayTaskDetails:e.fridayTaskDetails||"",saturdayTaskDetails:e.saturdayTaskDetails||"",sundayTaskDetails:e.sundayTaskDetails||"",monday:a(e.mondayHours),tuesday:a(e.tuesdayHours),wednesday:a(e.wednesdayHours),thursday:a(e.thursdayHours),friday:a(e.fridayHours),saturday:a(e.saturdayHours),sunday:a(e.sundayHours),totalHours:a(e.mondayHours)+a(e.tuesdayHours)+a(e.wednesdayHours)+a(e.thursdayHours)+a(e.fridayHours)+a(e.saturdayHours)+a(e.sundayHours)}})},_loadTimesheetEntriesFromBackend:function(e){var a=this.getView().getModel();var r=this;var o=a.getProperty("/currentWeekStart");var i=this._formatDateForOData(o);var l=new Date(o);l.setDate(l.getDate()+6);var d=this._formatDateForOData(l);var u=this.getOwnerComponent().getModel("adminService");var c=[new s("employeeID",n.EQ,e),new s("date",n.BT,i,d)];u.read("/Timesheets",{filters:c,success:function(e){var t=e.results||[];var o=a.getProperty("/employeeProjects")||[];var s=[];var n={};t.forEach(function(e){var t=e.projectID;if(!n[t]){n[t]={projectId:t,project:e.projectName||"",task:e.task||"General",taskDetails:e.taskDetails||"",monday:"0.00",tuesday:"0.00",wednesday:"0.00",thursday:"0.00",friday:"0.00",saturday:"0.00",sunday:"0.00",totalHours:"0.00"}}var a=new Date(e.date);var o=a.getDay();var s=r._getDayName(o);if(s&&e.hours){n[t][s]=parseFloat(e.hours).toFixed(2)}});Object.keys(n).forEach(function(e){var t=n[e];var a=0;var r=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"];for(var o=0;o<r.length;o++){var i=parseFloat(t[r[o]])||0;a+=i}t.totalHours=a.toFixed(2);s.push(t)});o.forEach(function(e){if(!n[e.projectId]){s.push({projectId:e.projectId,project:e.name,task:"General",taskDetails:"Work on "+e.name,monday:"0.00",tuesday:"0.00",wednesday:"0.00",thursday:"0.00",friday:"0.00",saturday:"0.00",sunday:"0.00",totalHours:"0.00"})}});a.setProperty("/timesheetEntries",s)},error:function(e){console.error("Error loading timesheet entries:",e);t.show("Error loading timesheet data");var r=a.getProperty("/employeeProjects")||[];var o=[];r.forEach(function(e){o.push({projectId:e.projectId,project:e.name,task:"General",taskDetails:"Work on "+e.name,monday:"0.00",tuesday:"0.00",wednesday:"0.00",thursday:"0.00",friday:"0.00",saturday:"0.00",sunday:"0.00",totalHours:"0.00"})});a.setProperty("/timesheetEntries",o)}})},_formatDateForOData:function(e){var t=(e.getMonth()+1).toString().padStart(2,"0");var a=e.getDate().toString().padStart(2,"0");return e.getFullYear()+"-"+t+"-"+a},_getDayName:function(e){switch(e){case 1:return"monday";case 2:return"tuesday";case 3:return"wednesday";case 4:return"thursday";case 5:return"friday";case 6:return"saturday";case 0:return"sunday";default:return null}},_loadEmployeeProjects:function(e){var t=this.getView().getModel();var a=t.getProperty("/projects")||[];var r=a.filter(function(t){return t.managerId===e||t.teamMembers&&t.teamMembers.includes(e)});t.setProperty("/employeeProjects",r)},onEmployeeChange:function(e){let t=this.getView().getModel();let a=e.getParameter("selectedItem")?e.getParameter("selectedItem").getKey():e.getSource().getSelectedKey();t.setProperty("/selectedEmployee",a);localStorage.setItem("selectedEmployeeId",a);let r=t.getProperty("/currentWeekStart");let o=this._getWeekEnd(r);t.setProperty("/timesheetEntries",[]);t.setProperty("/totalWeekHours",0);this._loadAdminTimesheetData(a,r,o)},_getWeekEnd:function(e){let t=new Date(e);t.setDate(t.getDate()+6);return t},onHourButtonPress:function(e){try{var t=e.getSource();var a=t.getBindingContext();if(!a){sap.m.MessageToast.show("Unable to get binding context");return}var r=a.getObject();var o=this.getView().getModel();var s=o.getProperty("/weekDays")||[];var n=t.data("day");if(!n){var i=t.getBindingPath("text");if(i){n=i.toLowerCase()}else{sap.m.MessageToast.show("Unable to determine day");return}}var l=this._getDayIndex(n);var d=s[l]||this._getDefaultDate(l);var u=r[n]||0;var c=this._getWeekDates();var m=this._formatDateForDisplay(c[n]);if(!this._oHourEditDialog){var g=[];for(var p=0;p<=15;p++){g.push(new sap.ui.core.Item({key:p.toString(),text:p+" hour"+(p!==1?"s":"")}))}this._oHourEditDialog=new sap.m.Dialog({title:"Edit "+this._capitalize(n)+" Entry",contentWidth:"350px",titleAlignment:"Center",content:[new sap.m.VBox({items:[new sap.m.VBox({items:[new sap.m.Label({text:"Date:",design:"Bold"}).addStyleClass("sapUiTinyMarginBottom"),new sap.m.Input({value:"{/editData/date}",editable:false})]}).addStyleClass("sapUiTinyMarginBottom"),new sap.m.VBox({items:[new sap.m.Label({text:"Project:",design:"Bold"}).addStyleClass("sapUiTinyMarginBottom"),new sap.m.Input({value:"{/editData/projectName}",editable:false})]}).addStyleClass("sapUiTinyMarginBottom"),new sap.m.VBox({items:[new sap.m.Label({text:"Task",design:"Bold"}).addStyleClass("sapUiTinyMarginBottom"),new sap.m.Input({value:"{/editData/taskType}",editable:false})]}).addStyleClass("sapUiTinyMarginBottom"),new sap.m.VBox({items:[new sap.m.Label({text:"Hours:",design:"Bold",required:true}).addStyleClass("sapUiTinyMarginBottom"),new sap.m.Input({value:"{/editData/hours}",editable:false})]}).addStyleClass("sapUiTinyMarginBottom"),new sap.m.VBox({items:[new sap.m.Label({text:"Task Details:",design:"Bold"}).addStyleClass("sapUiTinyMarginBottom"),new sap.m.TextArea({value:"{/editData/taskDetails}",rows:4,width:"100%",editable:false})]})]}).addStyleClass("sapUiMediumMarginBeginEnd sapUiSmallMarginTopBottom")],beginButton:new sap.m.Button({text:"Close",type:"Emphasized",press:function(){this._oHourEditDialog.close()}.bind(this)})});this.getView().addDependent(this._oHourEditDialog)}var y=o.getProperty("/projects")||[];var f=r.project||"";if(r.projectId){var h=y.find(function(e){return e.projectId===r.projectId||e.ID===r.projectId});if(h){f=h.name||h.projectName}}var D=n+"TaskDetails";var v=r[D]||r.taskDetails||"";var w=new sap.ui.model.json.JSONModel({editData:{entryIndex:a.getPath().split("/")[2],entryId:r.ID,day:n,dayName:this._getDayDisplayName(n),date:m,projectName:f,projectId:r.projectId,taskType:r.task||"",hours:u>0?u.toString():"0",taskDetails:v}});this._oHourEditDialog.setModel(w);var I=this._getDayDisplayName(n);this._oHourEditDialog.setTitle("Edit "+I+" Entry");this._oHourEditDialog.open()}catch(e){console.error("Error in onHourButtonPress:",e);sap.m.MessageToast.show("Error opening edit dialog")}},_validateHours:function(e){var t=e.getSource().getValue();var a=this._oHourEditDialog.getModel();var r=a.getProperty("/editData");if(t===""||t===null||t===undefined){r.hoursState="Error"}else{var o=parseFloat(t);if(isNaN(o)||o<0||o>24){r.hoursState="Error"}else{r.hoursState="None"}}a.setProperty("/editData",r)},_saveHourEntry:function(){try{var e=this._oHourEditDialog.getModel();var t=e.getProperty("/editData");if(t.hoursState==="Error"||!t.hours||isNaN(t.hours)){sap.m.MessageToast.show("Please enter valid hours between 0 and 24");return}var a=parseFloat(t.hours);if(a<0||a>24){sap.m.MessageToast.show("Hours must be between 0 and 24");return}var r=this.getView().getModel();var o=r.getProperty("/timesheetEntries");var s=o[t.entryIndex];if(!s){sap.m.MessageToast.show("Error: Entry not found");return}s[t.day]=a;var n=t.day+"TaskDetails";s[n]=t.taskDetails;s.task=t.taskType;s.taskDetails=t.taskDetails;var i=0;var l=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"];for(var d=0;d<l.length;d++){var u=parseFloat(s[l[d]])||0;i+=u}s.totalHours=i.toFixed(2);r.setProperty("/timesheetEntries",o);sap.m.MessageToast.show(t.dayName+" entry updated successfully");this._oHourEditDialog.close();this._saveTimesheetToBackend()}catch(e){console.error("Error saving hour entry:",e);sap.m.MessageToast.show("Error saving entry")}},_capitalize:function(e){if(!e)return"";return e.charAt(0).toUpperCase()+e.slice(1)},_getDayIndex:function(e){var t={monday:0,tuesday:1,wednesday:2,thursday:3,friday:4,saturday:5,sunday:6};return t[e]||0},_getDayDisplayName:function(e){var t={monday:"Monday",tuesday:"Tuesday",wednesday:"Wednesday",thursday:"Thursday",friday:"Friday",saturday:"Saturday",sunday:"Sunday"};return t[e]||"Day"},_getDefaultDate:function(e){var t=["Nov 17","Nov 18","Nov 19","Nov 20","Nov 21","Nov 22","Nov 23"];return t[e]||"Unknown Date"},onPreviousWeek:function(){let e=this.getView().getModel();let t=new Date(e.getProperty("/currentWeekStart"));if(isNaN(t)){console.error("Invalid week start:",e.getProperty("/currentWeekStart"));return}t.setDate(t.getDate()-7);e.setProperty("/currentWeekStart",t);e.setProperty("/selectedDate",t);let a=new Date(t);let r=this._getWeekEnd(a);this._updateWeekDays(a);let o=e.getProperty("/selectedEmployee");if(o){this._loadAdminTimesheetData(o,a,r)}},onCurrentWeek:function(){let e=this.getView().getModel();let t=this._getWeekStart(new Date);e.setProperty("/currentWeekStart",t);e.setProperty("/selectedDate",t);let a=this._getWeekEnd(t);this._updateWeekDays(t);let r=e.getProperty("/selectedEmployee");if(r){this._loadAdminTimesheetData(r,t,a)}},onNextWeek:function(){let e=this.getView().getModel();let t=new Date(e.getProperty("/currentWeekStart"));if(isNaN(t)){console.error("Invalid week start:",e.getProperty("/currentWeekStart"));return}t.setDate(t.getDate()+7);e.setProperty("/currentWeekStart",t);e.setProperty("/selectedDate",t);let a=new Date(t);let r=this._getWeekEnd(a);this._updateWeekDays(a);let o=e.getProperty("/selectedEmployee");if(o){this._loadAdminTimesheetData(o,a,r)}},onDatePickerChange:function(e){I.show(0);let a=e.getParameter("value");if(!a){I.hide();return}let r=new Date(a);if(isNaN(r.getTime())){I.hide();return}let o=this.getView().getModel();let s=this._getWeekStart(r);o.setProperty("/currentWeekStart",s);o.setProperty("/selectedDate",r);this._updateWeekDays(s);let n=this._getWeekEnd(s);console.log("DatePicker changed:",{selectedDate:a,dateValue:r,weekStart:s,weekEnd:n,formattedWeekStart:this._formatDateForOData(s),formattedWeekEnd:this._formatDateForOData(n)});let i=o.getProperty("/selectedEmployee");if(i){this._loadAdminTimesheetData(i,s,n)}else{t.show("Please select an employee first")}I.hide()},_updateWeekDays:function(e){let t=this.getView().getModel();let a=new Date(e);let r=[];for(let e=0;e<7;e++){let t=new Date(a);t.setDate(t.getDate()+e);r.push(this._formatDay(t))}t.setProperty("/weekDays",r)},onRecordTime:function(){var e=this.getView().getModel();var a=e.getProperty("/selectedEmployee");var r=e.getProperty("/timesheetEntries");var o=e.getProperty("/currentWeekStart");if(!a){t.show("Please select an employee first");return}this._saveTimesheetToBackend(a,r,o)},_saveTimesheetToBackend:function(e,a,r){var o=this.getOwnerComponent().getModel("adminService");var i=this;var l=new Date(r);l.setDate(l.getDate()+6);var d=this._formatDateForOData(r);var u=this._formatDateForOData(l);var c=[new s("employeeID",n.EQ,e),new s("date",n.BT,d,u)];o.read("/Timesheets",{filters:c,success:function(s){var n=s.results||[];var c=[];n.forEach(function(e){var t=new Promise(function(t,a){o.remove("/Timesheets('"+e.ID+"')",{success:t,error:a})});c.push(t)});Promise.all(c).then(function(){var s=[];var n=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"];a.forEach(function(t){n.forEach(function(a,n){var l=parseFloat(t[a])||0;if(l>0){var c=new Date(r);c.setDate(c.getDate()+n);var m={employeeID:e,projectID:t.projectId,projectName:t.project,task:t.task,taskDetails:t[a+"TaskDetails"]||t.taskDetails||"",date:i._formatDateForOData(c),hours:l,weekStartDate:d,weekEndDate:u};var g=new Promise(function(e,t){o.create("/Timesheets",m,{success:e,error:t})});s.push(g)}})});Promise.all(s).then(function(){t.show("Timesheet recorded successfully for employee: "+e);i._loadAdminTimesheetData(e,r,l)}).catch(function(e){console.error("Error creating timesheet entries:",e);t.show("Error saving some timesheet entries")})}).catch(function(e){console.error("Error deleting existing timesheet entries:",e);t.show("Error updating timesheet entries")})},error:function(e){console.error("Error reading existing timesheet entries:",e);t.show("Error updating timesheet entries")}})},_generateUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,a=e=="x"?t:t&3|8;return a.toString(16)})},_loadEmployees:function(){var e=this.getOwnerComponent().getModel("adminService");var a=this;e.read("/Employees",{success:function(e){var r=e.value||e.results||[];console.log("Raw Employees Data from OData:",r);var o=a._formatEmployeeData(r);var s=["Employee","Manager"];var n=o.filter(e=>s.includes(e.roleName));var i=a.getView().getModel();i.setProperty("/users",n);if(o.length>0){let e=localStorage.getItem("selectedEmployeeId");let t=e||o[0].userId;i.setProperty("/selectedEmployee",t);let r=i.getProperty("/currentWeekStart");let s=a._getWeekEnd(r);a._loadAdminTimesheetData(t,r,s)}i.refresh(true);a._refreshAnalyticsData();t.show("Employees loaded successfully: "+o.length+" users")},error:function(e){console.error("Error loading employees:",e);t.show("Error loading employees data")}})},_loadProjects:function(){var e=this.getOwnerComponent().getModel("adminService");var a=this;e.read("/Projects",{success:function(e){var r=e.value||e.results||[];console.log("Raw Projects Data from OData:",r);var o=a._formatProjectData(r);console.log("Formatted Projects for UI:",o);var s=a.getView().getModel();s.setProperty("/projects",o);s.refresh(true);a._refreshAnalyticsData();t.show("Projects loaded successfully: "+o.length+" projects")},error:function(e){console.error("Error loading projects:",e);t.show("Error loading projects data")}})},_formatEmployeeData:function(e){var t=e.map(function(e){var t="";if(e.roleName&&e.roleName.trim()!==""){t=e.roleName}else if(e.Role&&e.Role.trim()!==""){t=e.Role}else if(e.role&&e.role.trim()!==""){t=e.role}else if(e.accessLevel&&e.accessLevel.trim()!==""){t=e.accessLevel}else{t="Employee"}if(t.toLowerCase().includes("admin")){t="Admin"}else if(t.toLowerCase().includes("manager")){t="Manager"}else{t="Employee"}console.log("Formatting employee - ID: "+(e.employeeID||e.EmployeeID||e.ID)+", Final normalized role: '"+t+"'"+" [Source: roleName='"+e.roleName+"', Role='"+e.Role+"', role='"+e.role+"', accessLevel='"+e.accessLevel+"']");var a={userId:e.employeeID||e.EmployeeID||e.ID,firstName:e.firstName||e.FirstName||"",lastName:e.lastName||e.LastName||"",email:e.email||e.Email||"",role:t,roleName:t,managerId:e.managerID_ID||e.ManagerID||"",managerName:e.managerName||e.ManagerName||"",status:e.isActive?"Active":"Inactive",backendId:e.ID||e.id||""};console.log("Formatted user:",a);return a});t.forEach(function(e){if(e.managerId){var a=t.find(function(t){return t.userId===e.managerId});if(a){e.managerName=a.firstName+" "+a.lastName}else if(!e.managerName){e.managerName="Unknown Manager"}}else if(!e.managerName){e.managerName=""}});return t},_formatProjectData:function(e){var t=this;var a=this.getView().getModel().getProperty("/users")||[];return e.map(function(e){console.log("Processing project:",e);var t=parseFloat(e.budget)||0;var r=parseFloat(e.allocatedHours)||0;var o=parseFloat(e.usedHours)||0;var s="Unknown Manager";var n=e.projectOwner_ID||"";if(n){var i=a.find(e=>e.userId===n);if(i){s=i.firstName+" "+i.lastName}}var l={projectId:e.projectID||e.ID,name:e.projectName||"Unknown Project",description:e.description||"",managerId:n,managerName:s,budget:t,allocatedHours:r,usedHours:o,startDate:e.startDate?new Date(e.startDate).toISOString().split("T")[0]:"2025-01-01",endDate:e.endDate?new Date(e.endDate).toISOString().split("T")[0]:"2025-12-31",status:e.status||"Active",client:e.client||"Internal",isBillable:e.isBillable!==undefined?e.isBillable:true,teamMembers:[]};console.log("Formatted project:",l);return l})},onAddUser:function(){this._loadUserDialog("create")},onEditUser:function(e){var t=e.getSource().getBindingContext().getObject();this._loadUserDialog("edit",t)},onToggleUserStatus:function(e){var t=e.getSource().getBindingContext().getObject();var a=this.getView().getModel();var r=a.getProperty("/users");var o=r.find(e=>e.userId===t.userId);if(o){o.status=o.status==="Active"?"Inactive":"Active";a.setProperty("/users",r);a.refresh(true);this._updateEmployeeInOData(o,false)}},_loadUserDialog:function(e,t){if(!this._oUserDialog){this._oUserDialog=new m({title:e==="create"?"Create New User":"Edit User",contentWidth:"500px",content:[new y({layout:"ResponsiveGridLayout",editable:true,content:[new p({text:"First Name"}),new d({value:"{/userData/firstName}",required:true,valueStateText:"First Name is required"}),new p({text:"Last Name"}),new d({value:"{/userData/lastName}",required:true,valueStateText:"Last Name is required"}),new p({text:"Email"}),new d({value:"{/userData/email}",type:"Email",required:true,valueStateText:"Valid Email is required"}),new p({text:"Role"}),new i({selectedKey:"{/userData/role}",items:[new l({key:"Employee",text:"Employee"}),new l({key:"Manager",text:"Manager"}),new l({key:"Admin",text:"Admin"})],required:true}),new p({text:"Manager"}),new i({selectedKey:"{/userData/managerId}",items:{path:"/managers",template:new l({key:"{managerId}",text:"{firstName} {lastName}"})},forceSelection:false}),new p({text:"Status"}),new i({selectedKey:"{/userData/status}",items:[new l({key:"Active",text:"Active"}),new l({key:"Inactive",text:"Inactive"})],required:true})]})],beginButton:new c({text:"Save",type:"Emphasized",press:this.onSaveUser.bind(this)}),endButton:new c({text:"Cancel",press:this.onCancelUser.bind(this)})});this.getView().addDependent(this._oUserDialog)}var r=new a({mode:e,userData:t?JSON.parse(JSON.stringify(t)):{firstName:"",lastName:"",email:"",role:"",managerId:"",managerName:"",status:"Active"},managers:this._getManagersList()});this._oUserDialog.setModel(r);this._oUserDialog.open()},_getManagersList:function(){var e=this.getView().getModel();var t=e.getProperty("/users");return t.filter(e=>e.role==="Manager"&&e.status==="Active")},onSaveUser:function(){var e=this._oUserDialog;var a=e.getModel();var r=JSON.parse(JSON.stringify(a.getProperty("/userData")));var o=a.getProperty("/mode");if(!r.firstName||!r.lastName||!r.email||!r.role){t.show("Please fill in all required fields");return}var s=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;if(!s.test(r.email)){t.show("Please enter a valid email address");return}var n=this.getView().getModel();var i=n.getProperty("/users").slice();var l=i.some(e=>e.email===r.email&&(o==="create"||e.userId!==r.userId));if(l){t.show("Email address already exists");return}if(o==="edit"){var i=n.getProperty("/users");var d=i.findIndex(e=>e.userId===r.userId);if(d!==-1){i[d]={...i[d],firstName:r.firstName,lastName:r.lastName,email:r.email,role:r.role,roleName:r.roleName,managerId:r.managerId,status:r.status};if(r.managerId){var u=i.find(e=>e.userId===r.managerId);if(u){i[d].managerName=u.firstName+" "+u.lastName}else{i[d].managerName="Unknown Manager"}}else{i[d].managerName=""}n.setProperty("/users",i);n.refresh(true);t.show("User updated successfully in UI")}}else if(o==="create"){var c="EMP"+Math.floor(Math.random()*1e6).toString().padStart(6,"0");var m={userId:c,firstName:r.firstName,lastName:r.lastName,email:r.email,role:r.role,roleName:r.roleName,managerId:r.managerId,managerName:"",status:r.status};if(r.managerId){var u=i.find(e=>e.userId===r.managerId);if(u){m.managerName=u.firstName+" "+u.lastName}else{m.managerName="Unknown Manager"}}i.push(m);n.setProperty("/users",i);n.refresh(true);t.show("User added successfully in UI")}if(o==="create"){this._createEmployeeInOData(r,false)}else{this._updateEmployeeInOData(r,false)}e.close()},_createEmployeeInOData:function(e,a=true){var r=this.getOwnerComponent().getModel("adminService");var o=this;var s={firstName:e.firstName,lastName:e.lastName,email:e.email,roleName:e.role,managerID_ID:e.managerId||null,isActive:e.status==="Active"};console.log("Creating employee with payload:",s);r.create("/Employees",s,{success:function(e){t.show("User created successfully in backend");if(a){o._loadEmployees()}},error:function(e){console.error("Error creating employee:",e);t.show("Error creating user in backend");if(a){o._loadEmployees()}}})},_updateEmployeeInOData:function(e,a=true){var r=this.getOwnerComponent().getModel("adminService");var o=this;this._getUserRoleIdByName(e.role).then(function(s){return o._getManagerEmployeeId(e.managerId).then(function(n){r.read("/Employees",{success:function(i){var l=i.results.find(t=>t.employeeID===e.userId);if(!l){t.show("Employee not found.");return}var d=l.ID;var u={firstName:e.firstName,lastName:e.lastName,email:e.email,userRole_ID:s,managerID_ID:n,isActive:e.status==="Active"};var c="/Employees('"+d+"')";r.update(c,u,{success:function(){t.show("User updated successfully.");var r=o.getView().getModel();var i=r.getProperty("/users");let l=i.findIndex(t=>t.userId===e.userId);if(l!==-1){i[l].role=e.role;i[l].roleName=e.role;i[l].userRole_ID=s;i[l].managerID_ID=n;r.setProperty("/users",i)}if(a)o._loadEmployees()}})}})})})},_getUserRoleIdByName:function(e){return new Promise((t,a)=>{var r=this.getOwnerComponent().getModel("adminService");r.read("/UserRoles",{success:function(r){if(!r.results)return a("No UserRoles found");let o=r.results.find(t=>t.roleName===e);if(!o)return a("Role not found: "+e);t(o.ID)},error:a})})},_getManagerEmployeeId:function(e){return new Promise((t,a)=>{var r=this.getOwnerComponent().getModel("adminService");r.read("/AvailableManagers",{success:function(a){let r=a.results||[];let o=r.find(t=>t.employeeID===e);if(!o){t(null);return}t(o.employeeID)},error:a})})},onCancelUser:function(){if(this._oUserDialog){this._oUserDialog.close()}},onAddProject:function(){this._loadProjectDialog("create")},onEditProject:function(e){var t=e.getSource().getBindingContext().getObject();this._loadProjectDialog("edit",t)},onDeleteProject:function(e){var t=e.getSource().getBindingContext().getObject();o.confirm("Are you sure you want to delete project '"+t.name+"'?",{title:"Delete Project",onClose:function(e){if(e===o.Action.OK){this._deleteProjectInOData(t)}}.bind(this)})},_loadProjectDialog:function(e,t){if(!this._oProjectDialog){this._oProjectDialog=new m({title:e==="create"?"Create New Project":"Edit Project",contentWidth:"600px",content:[new y({layout:"ResponsiveGridLayout",editable:true,content:[new p({text:"Project Name"}),new d({value:"{/projectData/name}",required:true,valueStateText:"Project Name is required"}),new p({text:"Project Manager"}),new i({selectedKey:"{/projectData/managerId}",items:{path:"/managers",template:new l({key:"{userId}",text:"{firstName} {lastName}"})},required:true}),new p({text:"Budget ($)"}),new d({value:"{/projectData/budget}",type:"Number",valueStateText:"Budget must be a number"}),new p({text:"Allocated Hours"}),new d({value:"{/projectData/allocatedHours}",type:"Number",required:true,valueStateText:"Allocated Hours is required"}),new p({text:"Start Date"}),new u({value:"{/projectData/startDate}",valueFormat:"yyyy-MM-dd",required:true}),new p({text:"End Date"}),new u({value:"{/projectData/endDate}",valueFormat:"yyyy-MM-dd",required:true}),new p({text:"Status"}),new i({selectedKey:"{/projectData/status}",items:[new l({key:"Planning",text:"Planning"}),new l({key:"Active",text:"Active"}),new l({key:"On Hold",text:"On Hold"}),new l({key:"Completed",text:"Completed"}),new l({key:"Cancelled",text:"Cancelled"})],required:true})]})],beginButton:new c({text:"Save",type:"Emphasized",press:this.onSaveProject.bind(this)}),endButton:new c({text:"Cancel",press:this.onCancelProject.bind(this)})});this.getView().addDependent(this._oProjectDialog)}var r=new a({mode:e,projectData:t?JSON.parse(JSON.stringify(t)):{ID:"",name:"",projectID:"",description:"",managerId:"",budget:0,allocatedHours:0,usedHours:0,startDate:(new Date).toISOString().split("T")[0],endDate:new Date((new Date).setFullYear((new Date).getFullYear()+1)).toISOString().split("T")[0],client:"",status:"Planning"},managers:this._getManagersList()});this._oProjectDialog.setModel(r);this._oProjectDialog.open()},onSaveProject:function(){var e=this._oProjectDialog;var a=e.getModel();var r=JSON.parse(JSON.stringify(a.getProperty("/projectData")));var o=a.getProperty("/mode");if(!r.name||!r.managerId||!r.startDate||!r.endDate||!r.allocatedHours){t.show("Please fill in all required fields");return}r.budget=parseFloat(r.budget)||0;r.allocatedHours=parseFloat(r.allocatedHours)||0;r.usedHours=parseFloat(r.usedHours)||0;var s=new Date(r.startDate);var n=new Date(r.endDate);if(n<=s){t.show("End date must be after start date");return}if(r.usedHours<0||r.allocatedHours<0){t.show("Hours cannot be negative");return}if(r.usedHours>r.allocatedHours){t.show("Used hours cannot exceed allocated hours");return}if(o==="edit"){var i=this.getView().getModel();var l=i.getProperty("/projects");var d=l.findIndex(e=>e.projectId===r.projectId);if(d!==-1){var u=this._getManagersList();var c=u.find(e=>e.userId===r.managerId);var m=c?c.firstName+" "+c.lastName:"Unknown Manager";l[d]={...l[d],name:r.name,description:r.description,managerId:r.managerId,managerName:m,budget:r.budget,allocatedHours:r.allocatedHours,usedHours:r.usedHours,startDate:r.startDate,endDate:r.endDate,client:r.client,status:r.status};i.setProperty("/projects",l);i.refresh(true);t.show("Project updated successfully in UI")}}else if(o==="create"){var i=this.getView().getModel();var l=i.getProperty("/projects");var u=this._getManagersList();var c=u.find(e=>e.userId===r.managerId);var m=c?c.firstName+" "+c.lastName:"Unknown Manager";var g="PRJ"+Math.floor(Math.random()*1e5).toString().padStart(5,"0");var p={projectId:g,name:r.name,description:r.description,managerId:r.managerId,managerName:m,budget:r.budget,allocatedHours:r.allocatedHours,usedHours:r.usedHours,startDate:r.startDate,endDate:r.endDate,client:r.client,status:r.status,isBillable:true,teamMembers:[]};l.push(p);i.setProperty("/projects",l);i.refresh(true);t.show("Project added successfully in UI")}if(o==="create"){this._createProjectInOData(r,false)}else{this._updateProjectInOData(r,false)}e.close()},_createProjectInOData:function(e,a=true){var r=this.getOwnerComponent().getModel("adminService");var o=this;var s={projectName:e.name,description:e.description||"",projectOwner_ID:e.managerId,budget:parseFloat(e.budget)||0,allocatedHours:parseFloat(e.allocatedHours)||0,startDate:e.startDate,endDate:e.endDate,status:e.status,isBillable:true};console.log("Creating project with payload:",s);r.create("/Projects",s,{success:function(e){t.show("Project created successfully");if(a){o._loadProjects()}},error:function(e){console.error("Error creating project:",e);t.show("Error creating project");if(a){o._loadProjects()}}})},_updateProjectInOData:function(e,a=true){var r=this.getOwnerComponent().getModel("adminService");var o=this;if(!e.projectId){t.show("Missing projectId. Cannot update.");console.warn("No projectId found in projectData:",e);return}r.read("/Projects",{success:function(s){if(!s.results||!s.results.length){t.show("No projects found in backend.");return}var n=s.results.find(t=>t.projectID===e.projectId);if(!n){t.show("Project not found in backend. Cannot update.");console.warn("No backend match for projectId:",e.projectId);return}var i=n.ID;if(!i){t.show("Backend Project ID missing. Cannot update.");console.error("Backend item has no ID field:",n);return}var l={projectName:e.name,description:e.description||"",projectOwner_ID:e.managerId,budget:parseFloat(e.budget)||0,allocatedHours:parseFloat(e.allocatedHours)||0,startDate:e.startDate,endDate:e.endDate,status:e.status};var d="/Projects('"+i+"')";console.log("Updating project:",i,l);r.update(d,l,{success:function(){t.show("Project updated successfully");if(a){o._loadProjects()}},error:function(e){console.error("Error updating project:",e);t.show("Error updating project");if(a){o._loadProjects()}}})},error:function(e){console.error("Error reading Projects:",e);t.show("Failed to fetch backend projects.")}})},_deleteProjectInOData:function(e){var a=this.getOwnerComponent().getModel("adminService");var r=this;a.read("/Projects",{success:function(o){if(!o.results||o.results.length===0){t.show("No projects found. Cannot delete.");return}var s=o.results.find(function(t){return t.projectID===e.projectId});if(!s){t.show("Project not found. Cannot delete.");console.warn("No backend match for projectId:",e.projectId);return}var n=s.ID;var i="/Projects('"+n+"')";console.log("Deleting project with backend ID:",n);a.remove(i,{success:function(){t.show("Project deleted successfully");r._loadProjects()},error:function(e){console.error("Error deleting project:",e);t.show("Error deleting project")}})},error:function(e){console.error("Error loading projects:",e);t.show("Error fetching project list")}})},onCancelProject:function(){if(this._oProjectDialog){this._oProjectDialog.close()}},onRefreshAnalytics:function(){this._refreshAnalyticsData();t.show("Analytics data refreshed")},_refreshAnalyticsData:function(){var e=this.getView().getModel();var t=e.getProperty("/projects")||[];var a=e.getProperty("/users")||[];var r=t.map(function(e){var t=e.usedHours||0;var a=e.allocatedHours||0;var r=a-t;var o=a>0?Math.round(t/a*100):0;return{projectId:e.projectId,projectName:e.name,allocatedHours:a,bookedHours:t,remainingHours:r,utilization:o}});var o=this._getManagersList().map(function(e){var r=a.filter(t=>t.managerId===e.userId&&t.status==="Active");var o=t.filter(t=>t.managerId===e.userId);var s=o.reduce(function(e,t){return e+(t.usedHours||0)},0);var n=o.reduce(function(e,t){return e+(t.allocatedHours||0)},0);var i=n>0?Math.round(s/n*100):0;return{managerId:e.userId,managerName:e.firstName+" "+e.lastName,teamSize:r.length,totalProjects:o.length,totalBookedHours:s,avgUtilization:i}});var s=t.map(function(e){var t=e.startDate?new Date(e.startDate):null;var a=e.endDate?new Date(e.endDate):null;var r=new Date;var o=0;if(t&&a){o=Math.ceil((a-t)/(1e3*60*60*24))}var s=0;if(a){s=Math.ceil((a-r)/(1e3*60*60*24))}var n="On Track";if(e.status==="Completed"){n="Completed"}else if(s<0){n="Delayed"}else if(s<14){n="At Risk"}return{projectId:e.projectId,projectName:e.name,startDate:t,endDate:a,durationDays:o,daysRemaining:s>0?s:0,timelineStatus:n}});var n=t.reduce(function(e,t){return e+(t.usedHours||0)},0);var i=t.reduce(function(e,t){return e+(t.allocatedHours||0)},0);var l=i-n;var d=i>0?Math.round(n/i*100):0;e.setProperty("/overallProgress",{totalBookedHours:n,totalAllocatedHours:i,totalRemainingHours:l,averageUtilization:d});e.setProperty("/projectHours",r);e.setProperty("/managerTeams",o);e.setProperty("/projectDurations",s);e.refresh(true);this._loadOverallProgress()},formatCurrency:function(e){if(e===null||e===undefined||isNaN(e)){return"$0.00"}var t=parseFloat(e);return"$"+t.toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")},onRefreshUsers:function(){this._loadEmployees();t.show("Users data refreshed")},onRefreshProjects:function(){this._loadProjects();t.show("Projects data refreshed")},onRefreshPage:function(){window.location.reload()}})});
sap.ui.predefine("admin/controller/App.controller", ["sap/ui/core/mvc/Controller"],e=>{"use strict";return e.extend("admin.controller.App",{onInit(){}})});
sap.ui.predefine("admin/model/models", ["sap/ui/model/json/JSONModel","sap/ui/Device"],function(e,n){"use strict";return{createDeviceModel:function(){var i=new e(n);i.setDefaultBindingMode("OneWay");return i}}});
sap.ui.require.preload({
	"admin/i18n/i18n.properties":'# This is the resource bundle for admin\n\n#Texts for manifest.json\n\n#XTIT: Application name\nappTitle=Admin\n\n#YDES: Application description\nappDescription=An SAP Fiori application.\n#XTIT: Main view title\ntitle=Admin',
	"admin/manifest.json":'{"_version":"1.76.0","sap.app":{"id":"admin","type":"application","i18n":{"bundleUrl":"i18n/i18n.properties","supportedLocales":[""]},"applicationVersion":{"version":"0.0.1"},"title":"{{appTitle}}","description":"{{appDescription}}","resources":"resources.json","sourceTemplate":{"id":"@sap/generator-fiori:basic","version":"1.19.5","toolsId":"d5997fb2-f33c-4362-8151-49d5ebc97753"},"dataSources":{"mainService":{"uri":"/odata/v4/admin/","type":"OData","settings":{"annotations":[],"odataVersion":"4.0"}},"adminService":{"uri":"/odata/v2/admin/","type":"OData","settings":{"odataVersion":"2.0","annotations":[]}}},"crossNavigation":{"inbounds":{"employee-display":{"semanticObject":"admin","action":"display","title":"Admin Portal","icon":"sap-icon://employee","signature":{"parameters":{},"additionalParameters":"allowed"}}}}},"sap.ui":{"technology":"UI5","icons":{"icon":"","favIcon":"","phone":"","phone@2":"","tablet":"","tablet@2":""},"deviceTypes":{"desktop":true,"tablet":true,"phone":true}},"sap.ui5":{"flexEnabled":true,"dependencies":{"minUI5Version":"1.142.0","libs":{"sap.m":{},"sap.ui.core":{}}},"contentDensities":{"compact":true,"cozy":true},"models":{"i18n":{"type":"sap.ui.model.resource.ResourceModel","settings":{"bundleName":"admin.i18n.i18n","supportedLocales":[""]}},"":{"dataSource":"mainService","preload":true,"settings":{"operationMode":"Server","autoExpandSelect":true,"earlyRequests":true}},"adminService":{"dataSource":"adminService","type":"sap.ui.model.odata.v2.ODataModel","settings":{"useBatch":false,"defaultBindingMode":"TwoWay","defaultOperationMode":"Server","defaultUpdateMethod":"MERGE"}}},"resources":{"css":[{"uri":"css/style.css"}]},"routing":{"config":{"routerClass":"sap.m.routing.Router","controlAggregation":"pages","controlId":"app","transition":"slide","type":"View","viewType":"XML","viewPath":"admin.view","async":true},"routes":[{"pattern":"","name":"admin","target":"admin"}],"targets":{"admin":{"viewName":"Admin","viewId":"admin","viewLevel":1}}},"rootView":{"viewName":"admin.view.App","type":"XML","id":"App","async":true},"flexBundle":false},"sap.cloud":{"public":true,"service":"timesheet-application"}}',
	"admin/view/Admin.view.xml":'<mvc:View\n  controllerName="admin.controller.Admin"\n  xmlns:mvc="sap.ui.core.mvc"\n  xmlns="sap.m"\n  xmlns:l="sap.ui.layout"\n  xmlns:f="sap.ui.layout.form"\n  xmlns:core="sap.ui.core"\n  xmlns:table="sap.ui.table"\n  height="100%"><Page id="adminPage" title="Admin Dashboard"><headerContent><Toolbar id="_IDGenToolbar3"><ToolbarSpacer id="_IDGenToolbarSpacer3" /><Button id="_IDGenButton13" icon="sap-icon://business-objects-experience"\n                type="Transparent"\n                tooltip="Analytics"\n                press="onAnalyticsPress" /><Button id="_IDGenButton14" icon="sap-icon://bell"\n                type="Transparent"\n                tooltip="Notifications"\n                press="onNotificationPress" /><Button id="_IDGenButton12" \n        icon="sap-icon://log"\n              type="Transparent"\n              press="onLogoutPress" /></Toolbar></headerContent><content><IconTabBar id="mainTabBar" class="sapUiResponsiveContentPadding" expanded="true" select="onTabSelect"><items><IconTabFilter id="userManagementTab" key="users" text="User Management" icon="sap-icon://employee"><Panel id="userPanel" headerText="Employee &amp; Manager Management" expandable="true" expanded="true"><headerToolbar><Toolbar id="_IDGenToolbar"><Title id="_IDGenTitle" text="User Management"/><ToolbarSpacer id="_IDGenToolbarSpacer"/><Button id="addUserBtn" text="Add User" type="Emphasized" icon="sap-icon://add" press="onAddUser"/><Button id="refreshUsersBtn" text="Refresh" icon="sap-icon://refresh" press="onRefreshUsers"/></Toolbar></headerToolbar><content><table:Table \n                  id="usersTable"\n                  rows="{/users}"\n                  selectionMode="Single"\n                  visibleRowCount="10"\n                  class="sapUiSmallMarginTopBottom"><table:columns><table:Column id="_IDGenColumn1" width="8rem"><Label id="_IDGenLabel" text="User ID"/><table:template><Text id="_IDGenText" text="{userId}"/></table:template></table:Column><table:Column id="_IDGenColumn2" width="12rem"><Label id="_IDGenLabel1" text="Full Name"/><table:template><Text id="_IDGenText1" text="{firstName} {lastName}"/></table:template></table:Column><table:Column id="_IDGenColumn3" width="15rem"><Label id="_IDGenLabel2" text="Email"/><table:template><Text id="_IDGenText2" text="{email}"/></table:template></table:Column><table:Column id="_IDGenColumn4" width="8rem"><Label id="_IDGenLabel3" text="Role"/><table:template><Text id="_IDGenText3" text="{role}"/></table:template></table:Column><table:Column id="_IDGenColumn5" width="12rem"><Label id="_IDGenLabel4" text="Manager"/><table:template><Text id="_IDGenText4" text="{managerName}"/></table:template></table:Column><table:Column id="_IDGenColumn6" width="8rem"><Label id="_IDGenLabel5" text="Status"/><table:template><ObjectStatus id="_IDGenObjectStatus" \n                          text="{status}"\n                          state="{= ${status} === \'Active\' ? \'Success\' : \'Error\' }"/></table:template></table:Column><table:Column id="_IDGenColumn7" width="12rem"><Label id="_IDGenLabel6" text="Actions"/><table:template><HBox id="_IDGenHBox"><Button id="_IDGenButton" \n                            text="Edit" \n                            type="Transparent" \n                            icon="sap-icon://edit"\n                            press="onEditUser"\n                            class="sapUiTinyMarginEnd"/><Button id="_IDGenButton1" \n                            text="{= ${status} === \'Active\' ? \'Deactivate\' : \'Activate\' }" \n                            type="Transparent"\n                            icon="{= ${status} === \'Active\' ? \'sap-icon://inactive\' : \'sap-icon://activate\' }"\n                            press="onToggleUserStatus"/></HBox></table:template></table:Column></table:columns></table:Table></content></Panel></IconTabFilter><IconTabFilter id="projectManagementTab" key="projects" text="Project Management" icon="sap-icon://projector"><Panel id="projectPanel" headerText="Project Management" expandable="true" expanded="true"><headerToolbar><Toolbar id="_IDGenToolbar1"><Title id="_IDGenTitle1" text="Project Management"/><ToolbarSpacer id="_IDGenToolbarSpacer1"/><Button id="addProjectBtn" text="Create Project" type="Emphasized" icon="sap-icon://add" press="onAddProject"/><Button id="refreshProjectsBtn" text="Refresh" icon="sap-icon://refresh" press="onRefreshProjects"/></Toolbar></headerToolbar><content><table:Table \n                  id="projectsTable"\n                  rows="{/projects}"\n                  selectionMode="Single"\n                  visibleRowCount="10"\n                  class="sapUiSmallMarginTopBottom"><table:columns><table:Column id="_IDGenColumn8" width="8rem"><Label id="_IDGenLabel7" text="Project ID"/><table:template><Text id="_IDGenText5" text="{projectId}"/></table:template></table:Column><table:Column id="_IDGenColumn9" width="15rem"><Label id="_IDGenLabel8" text="Project Name"/><table:template><Text id="_IDGenText6" text="{name}"/></table:template></table:Column><table:Column id="_IDGenColumn10" width="12rem"><Label id="_IDGenLabel9" text="Project Manager"/><table:template><Text id="_IDGenText7" text="{managerName}"/></table:template></table:Column><table:Column id="_IDGenColumn11" width="10rem"><Label id="_IDGenLabel10" text="Budget"/><table:template><Text id="_IDGenText8" text="{path: \'budget\', formatter: \'.formatCurrency\'}"/></table:template></table:Column><table:Column id="_IDGenColumn12" width="8rem"><Label id="_IDGenLabel11" text="Allocated Hours"/><table:template><Text id="_IDGenText9" text="{allocatedHours}"/></table:template></table:Column><table:Column id="_IDGenColumn14" width="8rem"><Label id="_IDGenLabel13" text="Status"/><table:template><ObjectStatus id="_IDGenObjectStatus1" \n                          text="{status}"\n                          state="{= ${status} === \'Active\' ? \'Success\' : ${status} === \'Completed\' ? \'Success\' : \'Warning\' }"/></table:template></table:Column><table:Column id="_IDGenColumn15" width="12rem"><Label id="_IDGenLabel14" text="Actions"/><table:template><HBox id="_IDGenHBox1"><Button id="_IDGenButton2" \n                            text="Edit" \n                            type="Transparent" \n                            icon="sap-icon://edit"\n                            press="onEditProject"\n                            class="sapUiTinyMarginEnd"/><Button id="_IDGenButton3" \n                            text="Delete" \n                            type="Transparent"\n                            icon="sap-icon://delete"\n                            press="onDeleteProject"/></HBox></table:template></table:Column></table:columns></table:Table></content></Panel></IconTabFilter><IconTabFilter id="timesheetTab" key="timesheet" text="Timesheet" icon="sap-icon://time-entry-request"><Panel id="timesheetPanel" headerText="Daily Time Entry" expandable="true" expanded="true"><headerToolbar><Toolbar id="timesheetToolbar"><Label id="employeeLabel" text="Employee:" class="sapUiTinyMarginEnd"/><Select id="employeeSelect" \n                    items="{/users}"\n                    selectedKey="{/selectedEmployee}"\n                    change="onEmployeeChange"\n                    class="sapUiTinyMarginEnd"\n                    forceSelection="false"\n                   ><core:Item id="_IDGenItem" key="{userId}" text="{firstName} {lastName}"/></Select><ToolbarSpacer id="timesheetSpacer"/><Button id="previousWeekBtn" text="Previous Week" icon="sap-icon://navigation-left-arrow" press="onPreviousWeek"/><Button id="currentWeekBtn" text="Current Week" type="Emphasized" press="onCurrentWeek"/><Button id="nextWeekBtn" text="Next Week" type="Default" press="onNextWeek"/><DatePicker id="datePicker" value="{timeEntryModel>/selectedDate}" change="onDatePickerChange" placeholder="Select any date" width="150px" class="sapUiTinyMarginEnd"/></Toolbar></headerToolbar><content><table:Table \n                  id="timesheetTable"\n                  rows="{/timesheetEntries}"\n                  selectionMode="None"\n                  visibleRowCount="10"\n                  class="sapUiSmallMarginTopBottom"><table:columns><table:Column id="projectColumn" width="15rem"><Label id="projectLabel" text="Project"/><table:template><Text id="projectText" text="{project}"/></table:template></table:Column><table:Column id="taskColumn" width="12rem"><Label id="taskLabel" text="Task"/><table:template><Text id="taskText" text="{task}"/></table:template></table:Column><table:Column id="taskDetailsColumn" width="15rem"><Label id="taskDetailsLabel" text="Task Details"\n                      /><table:template><Text id="taskDetailsText" text="{taskDetails}"/><HBox id="_IDGenHBox3" alignItems="Center" justifyContent="Center"><Button id="_IDGenButton4" icon="sap-icon://list" type="Transparent"\n                        press="onTaskDetailPress" tooltip="View task details"/></HBox></table:template></table:Column><table:Column id="mondayColumn" width="8rem"><Label id="mondayLabel" text="{/weekDays/0}"/><table:template><Button id="_IDGenButton5" text="{monday}" press="onHourButtonPress"/></table:template></table:Column><table:Column id="tuesdayColumn" width="8rem"><Label id="tuesdayLabel" text="{/weekDays/1}"/><table:template><Button id="_IDGenButton6" text="{tuesday}" press="onHourButtonPress"/></table:template></table:Column><table:Column id="wednesdayColumn" width="8rem"><Label id="wednesdayLabel" text="{/weekDays/2}"/><table:template><Button id="_IDGenButton7" text="{wednesday}" press="onHourButtonPress"/></table:template></table:Column><table:Column id="thursdayColumn" width="8rem"><Label id="thursdayLabel" text="{/weekDays/3}"/><table:template><Button id="_IDGenButton8" text="{thursday}" press="onHourButtonPress"/></table:template></table:Column><table:Column id="fridayColumn" width="8rem"><Label id="fridayLabel" text="{/weekDays/4}"/><table:template><Button id="_IDGenButton9" text="{friday}" press="onHourButtonPress"/></table:template></table:Column><table:Column id="saturdayColumn" width="8rem"><Label id="saturdayLabel" text="{/weekDays/5}"/><table:template><Button id="_IDGenButton10" text="{saturday}" press="onHourButtonPress"/></table:template></table:Column><table:Column id="sundayColumn" width="8rem"><Label id="sundayLabel" text="{/weekDays/6}"/><table:template><Button id="_IDGenButton11" text="{sunday}" press="onHourButtonPress"/></table:template></table:Column><table:Column id="totalHoursColumn" width="8rem"><Label id="totalHoursLabel" text="Total Hours"/><table:template><Text id="totalHoursText" text="{totalHours}"/></table:template></table:Column></table:columns></table:Table></content></Panel></IconTabFilter><IconTabFilter id="analyticsTab" key="analytics" text="Analytics &amp; Reports" icon="sap-icon://business-objects-experience"><Panel id="analyticsPanel" headerText="Project &amp; Team Analytics" expandable="true" expanded="true"><headerToolbar><Toolbar id="_IDGenToolbar2"><Title id="_IDGenTitle2" text="Project Analytics"/><ToolbarSpacer id="_IDGenToolbarSpacer2"/><Button id="refreshAnalyticsBtn" text="Refresh Data" icon="sap-icon://refresh" press="onRefreshAnalytics"/></Toolbar></headerToolbar><content><l:Grid id="_IDGenGrid" defaultSpan="L6 M6 S12" class="sapUiSmallMarginTop"><l:content><Panel id="_IDGenPanel" headerText="Project Hours Overview"><table:Table \n                        id="projectHoursTable"\n                        rows="{/projectHours}"\n                        selectionMode="None"\n                        visibleRowCount="5"><table:columns><table:Column id="_IDGenColumn16" width="15rem"><Label id="_IDGenLabel15" text="Project"/><table:template><Text id="_IDGenText11" text="{project}"/></table:template></table:Column><table:Column id="_IDGenColumn17" width="10rem"><Label id="_IDGenLabel16" text="Allocated Hours"/><table:template><Text id="_IDGenText12" text="{allocatedHours}"/></table:template></table:Column><table:Column id="_IDGenColumn18" width="10rem"><Label id="_IDGenLabel17" text="Booked Hours"/><table:template><Text id="_IDGenText13" text="{bookedHours}"/></table:template></table:Column><table:Column id="_IDGenColumn19" width="10rem"><Label id="_IDGenLabel18" text="Remaining Hours"/><table:template><Text id="_IDGenText14" text="{remainingHours}"/></table:template></table:Column><table:Column id="_IDGenColumn20" width="10rem"><Label id="_IDGenLabel19" text="Utilization %"/><table:template><ProgressIndicator id="_IDGenProgressIndicator" \n                                displayValue="{utilization}%"\n                                percentValue="{utilization}"\n                                state="{= ${utilization} > 90 ? \'Error\' : ${utilization} > 75 ? \'Warning\' : \'Success\' }"/></table:template></table:Column></table:columns></table:Table></Panel><Panel id="_IDGenPanel1" headerText="Manager Team Overview"><table:Table \n                        id="managerTeamsTable"\n                        rows="{/managerTeams}"\n                        selectionMode="None"\n                        visibleRowCount="5"><table:columns><table:Column id="_IDGenColumn21" width="12rem"><Label id="_IDGenLabel20" text="Manager"/><table:template><Text id="_IDGenText15" text="{managerName}"/></table:template></table:Column><table:Column id="_IDGenColumn22" width="8rem"><Label id="_IDGenLabel21" text="Team Size"/><table:template><Text id="_IDGenText16" text="{teamSize}"/></table:template></table:Column><table:Column id="_IDGenColumn23" width="10rem"><Label id="_IDGenLabel22" text="Total Projects"/><table:template><Text id="_IDGenText17" text="{totalProjects}"/></table:template></table:Column><table:Column id="_IDGenColumn24" width="12rem"><Label id="_IDGenLabel23" text="Total Booked Hours"/><table:template><Text id="_IDGenText18" text="{totalBookedHours}"/></table:template></table:Column><table:Column id="_IDGenColumn25" width="12rem"><Label id="_IDGenLabel24" text="Avg. Utilization"/><table:template><ProgressIndicator id="_IDGenProgressIndicator1" \n                                displayValue="{avgUtilization}%"\n                                percentValue="{avgUtilization}"\n                                state="{= ${avgUtilization} > 90 ? \'Error\' : ${avgUtilization} > 75 ? \'Warning\' : \'Success\' }"/></table:template></table:Column></table:columns></table:Table></Panel></l:content></l:Grid><Panel id="_IDGenPanel2" headerText="Project Engagement Duration" class="sapUiMediumMarginTop"><table:Table \n                    id="projectDurationTable"\n                    rows="{/projectDurations}"\n                    selectionMode="None"\n                    visibleRowCount="5"><table:columns><table:Column id="_IDGenColumn26" width="15rem"><Label id="_IDGenLabel25" text="Project"/><table:template><Text id="_IDGenText19" text="{projectName}"/></table:template></table:Column><table:Column id="_IDGenColumn27" width="12rem"><Label id="_IDGenLabel26" text="Start Date"/><table:template><Text id="_IDGenText20" \n          text="{path: \'startDate\', \n                 type: \'sap.ui.model.odata.type.DateTimeOffset\', \n                 formatOptions: { pattern: \'MMM dd, yyyy\' }}"\n          visible="{= !!${startDate}}"/></table:template></table:Column><table:Column id="_IDGenColumn28" width="12rem"><Label id="_IDGenLabel27" text="End Date"/><table:template><Text id="_IDGenText21" \n          text="{path: \'endDate\', \n                 type: \'sap.ui.model.odata.type.DateTimeOffset\', \n                 formatOptions: { pattern: \'MMM dd, yyyy\' }}"\n          visible="{= !!${endDate}}"/></table:template></table:Column><table:Column id="_IDGenColumn29" width="10rem"><Label id="_IDGenLabel28" text="Duration (Days)"/><table:template><Text id="_IDGenText22" text="{durationDays}"/></table:template></table:Column><table:Column id="_IDGenColumn30" width="10rem"><Label id="_IDGenLabel29" text="Days Remaining"/><table:template><ObjectStatus id="_IDGenObjectStatus2" \n                            text="{daysRemaining}"\n                            /></table:template></table:Column><table:Column id="_IDGenColumn31" width="12rem"><Label id="_IDGenLabel30" text="Status"/><table:template><ObjectStatus id="_IDGenObjectStatus3" \n                            text="{timelineStatus}"\n                            state="{= ${timelineStatus} === \'On Track\' ? \'Success\' : ${timelineStatus} === \'At Risk\' ? \'Warning\' : \'Error\' }"/></table:template></table:Column></table:columns></table:Table></Panel></content></Panel></IconTabFilter></items></IconTabBar></content></Page></mvc:View>',
	"admin/view/App.view.xml":'<mvc:View controllerName="admin.controller.App"\n    displayBlock="true"\n    xmlns:mvc="sap.ui.core.mvc"\n    xmlns="sap.m"><App id="app"></App></mvc:View>'
});
//# sourceMappingURL=Component-preload.js.map
